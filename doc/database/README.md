# 数据库说明

IM服务使用`MySql`数据库。数据库见[db.sql](db.sql)文件。初始化由[initdata.sql](initdata.sql)提供。

## 用户ID

全系统唯一用户ID由字符串组成，其中字符串格式以`U`开头。

## 消息ID

消息ID用于标识消息的唯一标识，按实际需求，只用在会话内保持唯一即可。为了方便处理，采用UUID -> HashId

> 更为理想的方式，是针对每一个会话产生有序的`ID`.但这意味着需要一个产生ID的服务。为了简单起见，先采用UUID -> HashId的方案。

## 资源URI

资源统一表示方式，包括url的存储区域（服务器）与逻辑路径，资源的类型，特定资源的类型的特定元数据，比如对于国片，有宽度与长度，对于视频资源，还有时间长度。

资源表示方式：

```
media:// + {storage.zone} + / + {media.type} + / + objectkey + ? + {query params}

```

对于示例：`media://zone01/image/im/singlechat/test?width=100&height=100`，其包含了以下信息：

 1. 资源类型为`image`。
 2. 存储图片的服务器为`zone01`,具体`zone01`的地址与信息由IM服务器解释。
 3. 资源在`zone01`服务器的逻辑路径为`im/singlechat/test`。
 4. 图片的宽度为100，高度为100。

## 消息类型

以下是对每一个消息类型的说明

 - 1:文本消息
 - 2:图片消息
 - 3:视频消息
 - 4:定位消息
 - 5:合并转发，背后是多条消息，以及来源
 - 6:转发消息，需要包括消息来源
 - 7:泡泡消息：icon,url,descript以及来源信息
 - 8:红包消息
 - 9:转账消息
 - 100+:扩展消息，开放给开放平台


